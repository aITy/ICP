# make [  | all | debug | submit | submit_zip | clean ]

#FIXME pozor na C++ variantu! (tedka to je makefile pro C)
#	all: dama2013-cli dama2013
#	doxygen (html vystup; zahrnout vsechny zdrojaky SOURCE_BROWSER = YES)
#	clean (smaze vsechny produkty prekladu)
#	pack (.tar.gz)
#	run (dama2013)
#	dama2013-cli

HDR = main.h
SRC = main.c
OBJ = $(SRC:.c=.o)
EXE ?= resulting_binary
SUB ?= archive_name
DOCNAME ?= manual

STRIP = strip -s
CC = gcc
#CC ?= i486-mingw32-gcc

#-Wextra used to be -W
__OS = $(shell uname)
CFLAGS = -std=c99 -Wall -Wextra -Werror -pedantic -Wlong-long \
				 -Wsign-conversion -Wconversion -Wimplicit-function-declaration \
				 $(shell [ "$(__OS)" == Linux ] && echo -D_POSIX_C_SOURCE=200112L)  # for getopt()
#				 $(shell [ "$(__OS)" == Linux ] && echo -D_POSIX_C_SOURCE=199309L)  # ???

all: $(EXE)

# define DEBUG macro while compilation
debug: CFLAGS += -DDEBUG -g3
debug: all

$(EXE): $(OBJ)
	$(CC) $(CFLAGS) -lm -lpthread -o $@ $(OBJ)

.c.o:
	$(CC) $(CFLAGS) -O2 -c $<

submit: clean doc
	tar cvzf $(SUB).tar.gz $(SRC) $(HDR) Makefile --exclude $(EXE)

submit_zip: clean doc
	zip -q $(SUB).zip -9 $(SRC) $(HDR) Makefile --exclude $(EXE)

# delete almost all files generated by configure and make
clean:
	rm -f $(OBJ)

# delete all files generated by configure and make
distclean: clean
	rm -f $(EXE) $(SUB).tar.gz $(DOCNAME).pdf

# article | report | book | memoir | letter | slides (transparent folie)
# date "+%d.%m.%Y"
doc:
	pandoc -S -s --toc -N --section-divs --no-tex-ligatures \
		--variable lang=czech \
		--variable date="$(shell date "+%x")" \
		--variable geometry=margin=2.5cm \
		--variable geometry=a4paper \
		--variable fontsize=11pt \
		--variable documentclass=report \
		--include-in-header=tex_header.include \
		-o $(DOCNAME).pdf $(DOCNAME).markdown
#report article
#		--template=template.latex
